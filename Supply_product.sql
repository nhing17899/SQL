CREATE TABLE S (
	SNO NVARCHAR(20) PRIMARY KEY,
	SNAME NVARCHAR(30),
	SSTATUS SMALLINT NOT NULL,
	CITY NVARCHAR(30)
)

CREATE TABLE P (
	PNO NVARCHAR(20) PRIMARY KEY,
	PNAME NVARCHAR(30),
	COLOUR NVARCHAR(30),
	WEIGHT SMALLINT NOT NULL,
	CITY NVARCHAR(30)
)

CREATE TABLE SP (
	SNO NVARCHAR(20) NOT NULL,
	PNO NVARCHAR(20) NOT NULL,
	QTY SMALLINT NOT NULL,
	CONSTRAINT PK_SNO_PNO PRIMARY KEY (SNO, PNO)
)

INSERT INTO S (SNO, SNAME, SSTATUS, CITY)
VALUES
	('S1', 'SMITH', 20, 'LONDON'),
	('S2', 'JONES', 10, 'PARIS'),
	('S3', 'BLAKE', 30, 'PARIS'),
	('S4', 'CLARK', 20, 'LONDON'),
	('S5', 'ADAMS', 30, 'ATHENS')
;

INSERT INTO P (PNO, PNAME, COLOUR, WEIGHT, CITY)
VALUES
	('P1', 'NUT', 'RED', 12, 'LONDON'),
	('P2', 'BOLT', 'GREEN', 17, 'PARIS'),
	('P3', 'SCREW', 'BLUE', 17, 'ROME'),
	('P4', 'SCREW', 'RED', 14, 'LONDON'),
	('P5', 'CAM', 'BLUE', 12, 'PARIS'),
	('P6', 'COG', 'RED', 19, 'LONDON')
;

INSERT INTO SP (SNO, PNO, QTY)
VALUES
	('S1', 'P1', 300),
	('S1', 'P2', 200),
	('S1', 'P3', 400),
	('S1', 'P4', 200),
	('S1', 'P5', 100),
	('S1', 'P6', 100),
	('S2', 'P1', 300),
	('S2', 'P2', 400),
	('S3', 'P2', 200),
	('S4', 'P2', 200),
	('S4', 'P4', 300),
	('S4', 'P5', 400)
;


/*1*/
SELECT S.SNAME
FROM S
LEFT OUTER JOIN SP ON SP.SNO = S.SNO
WHERE SP.SNO IS NULL

/*2*/
SELECT SNO
FROM SP
WHERE PNO = 'P1'

INTERSECT

SELECT SNO
FROM SP
WHERE PNO = 'P2'

/*3*/
SELECT PNAME, PNO
FROM P
WHERE PNO IN (
	SELECT PNO
	FROM SP
	WHERE SNO = 'S1'

	EXCEPT

	SELECT PNO
	FROM SP
	WHERE SNO = 'S2'
)

/*4*/
SELECT SNO
FROM SP
GROUP BY SNO
HAVING COUNT(PNO) = (
	SELECT COUNT(*)
	FROM dbo.P
)

/*5*/
SELECT SNO
FROM SP
GROUP BY SNO
HAVING COUNT(PNO) >= 2


DELETE FROM dbo.SP
WHERE (SNO = 'S1' AND PNO = 'P6') OR (SNO = 'S1' AND PNO = 'P5') OR (SNO = 'S1' AND PNO = 'P4')

SELECT * FROM SP

/*6*/
SELECT SNO AS COUNT_P
FROM SP
GROUP BY SNO
HAVING COUNT(PNO) = (
	SELECT TOP(1) COUNT(PNO) AS COUNT_P
	FROM SP
	GROUP BY SNO
	ORDER BY COUNT_P DESC
)